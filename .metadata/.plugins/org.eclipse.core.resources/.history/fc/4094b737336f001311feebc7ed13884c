<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions"
      xmlns:pe="http://primefaces.org/ui/extensions">
<f:view contentType="text/html" locale="en">
    <pe:head title="PrimeFaces Extensions HelloWorld" shortcutIcon="#{request.contextPath}/favicon.ico">
        <f:facet name="first">
            <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
            <meta http-equiv="pragma" content="no-cache"/>
            <meta http-equiv="cache-control" content="no-cache"/>
            <meta http-equiv="expires" content="0"/>
        </f:facet>
    </pe:head>
    <h:body>
        <pe:layout resizerTip="Resize Me" togglerTipClosed="Open Me" togglerTipOpen="Close Me">
            <pe:layoutPane position="north">
				<f:facet name="header">  
                    <h:outputText value="Search criteria for Job Posts"/>  
                </f:facet>
                <h:form id="searchform">
                <h:panelGroup id="myFilter" >
                <p:inputText id="myFilter_text" value="#{jobDetailsController.searchText}" style="width:150px" onkeyup="searchKeyPressedHandler();"/>
				</h:panelGroup>
                <p:commandButton value="Search" type="button" onclick="remoteCall();" style="margin-bottom: 10px;"/>
                <pe:remoteCommand name="remoteCall"  >  
           </pe:remoteCommand>
              </h:form>
                </pe:layoutPane>
            <pe:layoutPane position="east">
                East Block
            </pe:layoutPane>
            <pe:layoutPane position="center">
            <h:form id="masterDetailform">
         <!--    <pe:masterDetail id="masterDetail" level="#{simpleMasterDetailController.currentLevel}">

    <pe:masterDetailLevel level="1" levelLabel="Sports">
        <p:dataTable id="sports" value="#{simpleMasterDetailController.sports}" var="sport">
            <p:column headerText="Sport">
                <p:commandLink value="#{sport.name}">
                    <pe:selectDetailLevel contextValue="#{sport}"/>
                </p:commandLink>
            </p:column>
            <p:column headerText="Number of countries with leagues">
                <h:outputText value="#{fn:length(sport.countriesWithLeague)}"/>
            </p:column>
        </p:dataTable>
    </pe:masterDetailLevel>

    <pe:masterDetailLevel level="2" contextVar="sport" levelLabel="Countries having #{sport.name} leagues">
        <p:dataTable id="countries" value="#{sport.countriesWithLeague}" var="country">
            <p:column headerText="Country">
                <p:commandLink value="#{country.name}">
                    <pe:selectDetailLevel contextValue="#{country}"/>
                </p:commandLink>
            </p:column>
            <p:column headerText="Code">
                <h:outputText value="#{country.code}"/>
            </p:column>
        </p:dataTable>
    </pe:masterDetailLevel>

    <pe:masterDetailLevel level="3" contextVar="country" levelLabel="#{country.sport} leagues of #{country.name}">
        <p:dataTable id="leauges" value="#{country.leagues}" var="league">
            <p:column headerText="League">
                <h:outputText value="#{league.name}"/>
            </p:column>
            <p:column headerText="Number of teams">
                <h:outputText value="#{league.numberOfTeam}"/>
            </p:column>
        </p:dataTable>
        <h:panelGrid columns="2" style="margin-top: 10px">
            <p:commandButton value="Go to Sports" icon="ui-icon-arrowthickstop-1-w">
                <pe:selectDetailLevel level="1"/>
            </p:commandButton>
            <p:commandButton value="Go to Countries" icon="ui-icon-arrowthick-1-w">
                <pe:selectDetailLevel step="-1"/>
            </p:commandButton>
        </h:panelGrid>
    </pe:masterDetailLevel>

</pe:masterDetail>
             -->
    <pe:masterDetail id="masterDetail" level="#{jobDetailsController.currentLevel}">

    <pe:masterDetailLevel level="1" levelLabel="posts">
        <p:dataTable id="posts" value="#{jobDetailsController.jobPosts}" var="post" widgetVar="postsWidgetVar" filteredValue="#{jobDetailsController.filteredPosts}">
           <f:facet name="header">
           <p:inputText id="globalFilter"  onkeyup="postsWidgetVar.filter()"  style="width:150px;" /> 
          
           </f:facet>
            <p:column headerText="Post Title" filterBy="title" filterStyle="display:none;">
                <p:commandLink value="#{post.title}">
                    <pe:selectDetailLevel contextValue="#{post}"/>
                </p:commandLink>
            </p:column>
            <p:column headerText="Description" filterBy="postDescription" filterStyle="display:none;">
                <h:outputText value="#{post.postDescription}"/>
            </p:column>
             <p:column headerText="Location" filterBy="location" filterStyle="display:none;">
                <h:outputText value="#{post.location}"/>
            </p:column>
        </p:dataTable>
    </pe:masterDetailLevel>

    <pe:masterDetailLevel level="2" contextVar="post" levelLabel="Jobs related to #{post.title}">
        <p:dataTable id="jobs" value="#{post.jobDetails}" var="job">
            <p:column headerText="Job Category">
                <p:commandLink value="#{job.jobCategory}">
                    <pe:selectDetailLevel contextValue="#{job}"/>
                </p:commandLink>
            </p:column>
            <p:column headerText="Experience">
                <h:outputText value="#{job.experience}"/>
            </p:column>
            <p:column headerText="Position">
                <h:outputText value="#{job.position}"/>
            </p:column>
        </p:dataTable>
    </pe:masterDetailLevel>

    <pe:masterDetailLevel level="3" contextVar="job" levelLabel="Skills related to #{job.jobCategory}">
        <p:dataTable id="skills" value="#{job.skillsDetails}" var="skill">
            <p:column headerText="Frameworks/Technologies">
                <h:outputText value="#{skill.frameworks}"/>
            </p:column>
            <p:column headerText="Experience">
                <h:outputText value="#{skill.experience}"/>
            </p:column>
             <p:column headerText="Certifications">
                <h:outputText value="#{skill.certifications}"/>
            </p:column>
             <p:column headerText="Rating">
                <h:outputText value="#{skill.rating}"/>
            </p:column>
        </p:dataTable>
        <h:panelGrid columns="2" style="margin-top: 10px">
            <p:commandButton value="Go to Posts" icon="ui-icon-arrowthickstop-1-w">
                <pe:selectDetailLevel level="1"/>
            </p:commandButton>
            <p:commandButton value="Go to JobDetails" icon="ui-icon-arrowthick-1-w">
                <pe:selectDetailLevel step="-1"/>
            </p:commandButton>
        </h:panelGrid>
    </pe:masterDetailLevel>
    </pe:masterDetail>
    </h:form>
            </pe:layoutPane>
            <pe:layoutPane position="west" size="200">
             <f:facet name="header">  
                    <h:outputText value="Menu"/>  
                </f:facet>  
            <h:form>
              <p:menu style="width:95%" >
                        <p:menuitem value="Home" action="/admin/AdminHome.xhtml?faces-redirect=true" ajax="false" icon="ui-icon-home" /> 
                        <p:menuitem value="Employers list" action="/admin/UserList.xhtml?faces-redirect=true" ajax="false" icon="ui-icon-person"/>
                        <p:menuitem value="Logout" action="#{loginController.logout}" icon="ui-icon-power"/>
            </p:menu>
			</h:form>
            </pe:layoutPane>
            <pe:layoutPane position="south">
                 South Block
            </pe:layoutPane>
        </pe:layout>
    </h:body>
    <script>
    function searchKeyPressedHandler() {
        $(document).on("keyup", "input", function (event) {
            var searchValue = document
                .getElementById('searchform:myFilter_text').value;
            
            $("#masterDetailform\\:posts\\:globalFilter").val(searchValue);
            $("#masterDetailform\\:posts\\:globalFilter").trigger('keyup')
        });
    }
</script>
</f:view>
</html>