<!DOCTYPE html>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions"
	xmlns:pe="http://primefaces.org/ui/extensions"
	template="/templates/masterTemplate.xhtml">
	<ui:define name="content">
		<pe:layout resizerTip="Resize Me" togglerTipClosed="Open Me"
			fullPage="false" style="width:100%; height:650px;"
			togglerTipOpen="Close Me">
			<!-- <pe:layoutPane position="north">
                North Block
            </pe:layoutPane> -->
			<pe:layoutPane position="east" size="300">
				<f:facet name="header">
            		  Latest Updates
      		 		 </f:facet>

				<p:dataTable value="#{employerUpdatesController.recentupdates}"
					rows="4" var="monthinfo">
					<p:column>
						<p:panel header="#{monthinfo.monthname}">
							<h:outputText value="Posts:#{monthinfo.noofposts}"></h:outputText>
							<br />
							<h:outputText value="Total applications:#{monthinfo.applications}"></h:outputText>
							<br />
							<h:outputText value="Total selected:#{monthinfo.noofselected}"></h:outputText>
							
						</p:panel>
					</p:column>
				</p:dataTable>
			</pe:layoutPane>
			<pe:layoutPane position="center">
				<h:form id="employeeForm">
					<pe:remoteCommand name="remoteload">
					</pe:remoteCommand>
					<p:dataTable id="employerList" var="employer"
						value="#{employerDetailsController.employersModel}"
						paginator="true" rowKey="#{employer.orgname}" rows="10"
						paginatorPosition="bottom"
						paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
						rowsPerPageTemplate="5,10,15"
						selection="#{employerDetailsController.selectedEmployer}">
						<f:facet name="header">
            Registered Employers List
        </f:facet>
						<p:ajax event="page" onstart="PF('blockUIWidget').block()"
							oncomplete="PF('blockUIWidget').unblock()" />
						<p:ajax event="filter" id="filter"
							listener="#{employerDetailsController.onFilter}" />
						<p:column selectionMode="single" style="width:2%" />
						<p:column style="width:2%" exportable="false">
							<p:rowToggler />
						</p:column>
						<p:column filterBy="orgname" filterMatchMode="contains" width="70">
							<f:facet name="header">
								<h:outputText value="Organization name" />
							</f:facet>
							<h:outputText value="#{employer.orgname}" />
						</p:column>

						<p:column width="30">
							<f:facet name="header">
								<h:outputText value="Branch Name" />
							</f:facet>
							<h:outputText value="#{employer.branch}" />
						</p:column>

						<p:column width="30">
							<f:facet name="header">
								<h:outputText value="Established year" />
							</f:facet>
							<h:outputText value="#{employer.establishedyear}" />
						</p:column>

						<p:column width="70">
							<f:facet name="header">
								<h:outputText value="Number of employees" />
							</f:facet>
							<h:outputText value="#{employer.noofemployees}" />
						</p:column>
						<p:rowExpansion>
							<p:dataTable id="employerDetails" var="details"
								value="#{employer.employerDetails}" style="width:300px;">

								<f:facet name="header">
									<h:outputText value="Additional Details"></h:outputText>
								</f:facet>
								<p:column>
									<f:facet name="header">
										<h:outputText value="City Name"></h:outputText>
									</f:facet>
									<h:outputText value="#{details.city}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="Number of vacansies"></h:outputText>
									</f:facet>
									<h:outputText value="#{details.noofvacancies}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="Number of employees"></h:outputText>
									</f:facet>
									<h:outputText value="#{details.noofemployees}" />
								</p:column>
								<p:column>
									<f:facet name="header">
										<h:outputText value="Number of clients"></h:outputText>
									</f:facet>
									<h:outputText value="#{details.noofclients}" />
								</p:column>
							</p:dataTable>

						</p:rowExpansion>
						<p:columnGroup type="footer" id="columngroup">
							<p:outputPanel id="total">
								<p:row>
									<p:column colspan="5" footerText="Total:"
										style="text-align:right" />

									<p:column
										footerText="#{employerDetailsController.employeeTotal}" />
								</p:row>
							</p:outputPanel>
						</p:columnGroup>
						<f:facet name="footer">
							<p:commandButton id="viewButton" value="Edit"
								icon="ui-icon-search" update=":employeeForm:displaySingle"
								oncomplete="PF('singleEmployerDialog').show()" />
						</f:facet>
					</p:dataTable>


					<p:dialog id="dialog" header="Employer Detail"
						widgetVar="singleEmployerDialog" resizable="false"
						showEffect="fade" hideEffect="explode">
						<pe:spotlight id="idPanel1"
							blocked="#{employerDetailsController.editable}"
							style="padding:10px;margin:10px;"
							styleClass="ui-widget ui-widget-content ui-corner-all">
							<h:panelGrid id="displaySingle" columns="2" cellpadding="4">


								<h:outputText value="Organization Name:" />
								<h:inputText
									value="#{employerDetailsController.selectedEmployer.orgname}"
									style="font-weight:bold"
									disabled="#{!employerDetailsController.editable}" />

								<h:outputText value="Branch:" />
								<h:inputText
									value="#{employerDetailsController.selectedEmployer.branch}"
									disabled="#{!employerDetailsController.editable}"
									style="font-weight:bold" />

								<h:outputText value="Established year:" />
								<h:inputText
									value="#{employerDetailsController.selectedEmployer.establishedyear}"
									disabled="#{!employerDetailsController.editable}"
									style="font-weight:bold" />

								<h:outputText value="Number of employees:" />
								<h:inputText
									value="#{employerDetailsController.selectedEmployer.noofemployees}"
									style="font-weight:bold"
									disabled="#{!employerDetailsController.editable}" />
							</h:panelGrid>
							<p:selectBooleanButton
								value="#{employerDetailsController.editable}" offLabel="Edit"
								onLabel="Save">
								<p:ajax event="change" process="idPanel1"
									update="idPanel1,employerList" />
							</p:selectBooleanButton>
						</pe:spotlight>
					</p:dialog>

					<pe:blockUI target="employerList" content="blockUIContent"
						widgetVar="blockUIWidget" />

					<h:panelGrid id="blockUIContent" columns="2" style="display:none;">
						<h:graphicImage value="/resources/images/process/ajax-loader.gif"
							style="margin-right: 12px; vertical-align: middle;" />
						<h:outputText value="Please wait, data is being processed..."
							style="white-space: nowrap;" />
					</h:panelGrid>
					<p:panel header="Export PDF and Excel">
						<p:commandLink id="pdf" ajax="false">
							<p:graphicImage value="/resources/images/exporticons/pdf.png" />
							<pe:exporter type="pdf" target="employerList"
								fileName="Employer Details" />

						</p:commandLink>

						<p:spacer width="20" />

						<p:commandLink id="xls" ajax="false">
							<p:graphicImage value="/resources/images/exporticons/excel.png" />
							<pe:exporter type="xlsx" target="employerList"
								fileName="Employer Details" />

						</p:commandLink>
					</p:panel>
				</h:form>
			</pe:layoutPane>
			<pe:layoutPane position="west" size="400">
				<f:facet name="header">
            		  New Employer Registration
      		 		 </f:facet>
				<h:form id="registration">
					<p:panel>

						<p:messages errorClass="error" />

						<h:panelGrid columns="2" columnClasses="label, value"
							styleClass="grid">
							<h:outputText value="Organization Name *" />
							<p:inputText id="org" required="true" label="OrgName"
								title="Please enter organization name"
								value="#{employerDetailsController.enrolledEmployer.orgname}" />

							<h:outputText value="Main Branch *" />
							<p:inputText id="branch" required="true" label="Branch"
								title="Please enter branchname"
								value="#{employerDetailsController.enrolledEmployer.branch}" />

							<h:outputText value="Established Year: * "
								title="Please enter Year" />
							<p:inputText id="year"
								value="#{employerDetailsController.enrolledEmployer.establishedyear}" />

							<h:outputText value="Number of employees: "
								title="Please enter employee count" />
							<p:inputText id="noofemployee"
								value="#{employerDetailsController.enrolledEmployer.noofemployees}" />


						</h:panelGrid>
						<p:commandButton value="Register" update=":employeeForm"
							actionListener="#{employerDetailsController.registerEmployer}"
							onstart="PF('blockUIWidgetPage').block()"
							oncomplete="PF('blockUIWidgetPage').unblock()"></p:commandButton>
						<pe:blockUI widgetVar="blockUIWidgetPage">
							<h:panelGrid columns="2">
								<h:graphicImage
									value="/resources/images/process/ajax-loader.gif"
									style="margin-right: 12px; vertical-align: middle;" />
								<h:outputText value="Please wait, data is being inserted..."
									style="white-space: nowrap;" />
							</h:panelGrid>
						</pe:blockUI>
						<pe:tooltip global="true" myPosition="left center"
							atPosition="right center" />
						<pe:keyFilter for="org" mask="alphanum" />
						<pe:keyFilter for="branch" regEx="/[a-z0-9_]/i" />
						<pe:keyFilter for="year" mask="num" />
						<pe:keyFilter for="noofemployee" mask="num" />

					</p:panel>
				</h:form>
			</pe:layoutPane>
			<!-- <pe:layoutPane position="south">
                 South Block
            </pe:layoutPane> -->
		</pe:layout>
	</ui:define>
</ui:composition>